<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Equities Minimum Commission Backtest — min_commission_backtest • rsims</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Equities Minimum Commission Backtest — min_commission_backtest"><meta property="og:description" content="Quasi event-based simulation based on target share weights,
prices, commissions and interest.
The function is quite opinionated with respect to the data that it expects.
The idea is that user effort is spent in upstream data wrangling, and the
payoff is an extremely efficient backtesting routine, enabling fast
experimentation with parameters such as trade_buffer and different
commission models."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rsims</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Wrangling-data-for-input-to-simulation-engine.html">Wrangling data for input to simulation engine</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Equities Minimum Commission Backtest</h1>
    
    <div class="hidden name"><code>min_commission_backtest.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Quasi event-based simulation based on target share weights,
prices, commissions and interest.</p>
<p>The function is quite opinionated with respect to the data that it expects.
The idea is that user effort is spent in upstream data wrangling, and the
payoff is an extremely efficient backtesting routine, enabling fast
experimentation with parameters such as <code>trade_buffer</code> and different
commission models.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">min_commission_backtest</span><span class="op">(</span></span>
<span>  <span class="va">prices</span>,</span>
<span>  <span class="va">unadjusted_prices</span>,</span>
<span>  <span class="va">target_weights</span>,</span>
<span>  interest_rates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  short_borrow_costs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trade_buffer <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  initial_cash <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  capitalise_profits <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">commission_fun</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>prices</dt>
<dd><p>Matrix of trade prices. Column 1 must be the timestamp or index.</p></dd>


<dt>unadjusted_prices</dt>
<dd><p>Matrix of unadjusted prices. Column 1 must be the
timestamp or index. Used to calculate commission based on actual number of
shares traded.</p></dd>


<dt>target_weights</dt>
<dd><p>Matrix of target weights. Column 1 must be the
timestamp or index.</p></dd>


<dt>interest_rates</dt>
<dd><p>Matrix of daily interest rates applied to unused cash
(positive interest) and borrowed cash (negative interest). If not passed,
assumes constant interest rate of zero.</p></dd>


<dt>short_borrow_costs</dt>
<dd><p>Named vector of annualised short borrow costs as percent. For
example, c("TLT" = 0.0025) is equivalent to a short borrow cost of 0.25%pa for
TLT. Defaults to zero.</p></dd>


<dt>trade_buffer</dt>
<dd><p>Trade buffer parameter (see details)</p></dd>


<dt>initial_cash</dt>
<dd><p>Inital cash balance</p></dd>


<dt>capitalise_profits</dt>
<dd><p>If TRUE, utilise profits and initial cash balance in determining position sizes. If FALSE, profits accrue as a cash balance and are not reinvested.</p></dd>


<dt>commission_fun</dt>
<dd><p>Function for determining commissions from prices and
trades</p></dd>


<dt>...</dt>
<dd><p>Additional arguments passed to commission_fun. For
<code>us_tiered_commission</code>, this will be <code>max_pct_per_order</code> (the maximum
commission as a percentage of order value), <code>min_dollars_per_order</code> (the
minimum commission in dollars of a single order), <code>dollars_per_share</code> (the
per-share cost in dollars - for IB fixed tier, 0.005 is reasonable).</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>long dataframe of results consisting of the following columns:
ticker: Ticker or Cash
date: In YYYY-MM-DD format
close: Closing price (adjusted).
shares: Number of shares held.
exposure: Value of exposure to current ticker or to Cash.
share_trades: Number of shares traded, including any positions that
were liquidated fully or partially.
trade_value: Value of shares traded, including any positions that
were liquidated fully or partially.
commission: Commissions paid on today's trading, including any liquidated
positions.
interest: Interest accrued on yesterday's cash balance and settled today.
short_borrow: Borrow costs from holding yesterday's short positions through
today's close.
margin_call: Boolean indicating whether a margin call occurred today.
reduced_target_pos: Boolean indicating whether target positions could not be
executed due to insufficient margin, and were scaled back accordingly.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p><code>target_weights</code>,  <code>prices</code>, <code>unadjusted_prices</code>, and <code>interest_rates</code> should
be date-aligned.</p>
<p>The function will error if these matrixes are of different
shape, or have different values in Column 1 (the date or index column).
A simple approach to ensuring inputs conform with this requirement is in the
vignette.</p>
<p>It is up to the user to lag <code>target_weights</code> as necessary to ensure that
trades occur at appropriate prices. Specifically, the function assumes that
<code>target_weights</code> are date-aligned with <code>prices</code> such that the price at which
you assume you trade into a target weight has the same index value.</p>
<p><code>interest_rates</code> are the daily percentage interest rate applied to the cash
balance. It is up to the user to ensure this is in the correct format (for
instance dividing by 100*365 if your raw data is in percent per-anum), and to
apply a broker spread if necessary.</p>
<p>The function assumes a margin requirement of 0.25 the value of the shares
held and will liquidate positions if this requirement is not met (ie will
simulate a margin call).</p>
<p>The function doesn't consider short borrow costs yet.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">results_df</span> <span class="op">&lt;-</span> <span class="fu">min_commission_backtest</span><span class="op">(</span></span></span>
<span class="r-in"><span>  prices <span class="op">=</span> <span class="va">backtest_prices</span>,</span></span>
<span class="r-in"><span>  unadjusted_prices <span class="op">=</span> <span class="va">unadjusted_prices</span>,</span></span>
<span class="r-in"><span>  target_weights <span class="op">=</span> <span class="va">target_weights</span>,</span></span>
<span class="r-in"><span>  interest_rates <span class="op">=</span> <span class="va">rates</span>,</span></span>
<span class="r-in"><span>  trade_buffer <span class="op">=</span> <span class="va">trade_buffer</span>,</span></span>
<span class="r-in"><span>  initial_cash <span class="op">=</span> <span class="va">initial_cash</span>,</span></span>
<span class="r-in"><span>  capitalise_profits <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  commission_fun <span class="op">=</span> <span class="va">us_tiered_commission</span>,</span></span>
<span class="r-in"><span>  max_pct_per_order <span class="op">=</span> <span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>  min_dollars_per_order <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  dollars_per_share <span class="op">=</span> <span class="fl">0.005</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Kris Longmore-Dodd.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

