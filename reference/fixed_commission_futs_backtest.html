<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Futures Backtest, roll on days to expiry, fixed commission model — fixed_commission_futs_backtest • rsims</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Futures Backtest, roll on days to expiry, fixed commission model — fixed_commission_futs_backtest"><meta property="og:description" content="Quasi event-based simulation based on desired futures positions, raw
contract prices (ie not backadjusted) and roll dates determine by maximum
open interest.
The function is quite opinionated with respect to the data that it expects.
The idea is that user effort is spent in upstream data wrangling (the
wrangle_contracts_on_oi, make_sim_prices_matrix, and
make_sim_weights_matrix functions help with this), and the payoff is an
extremely efficient backtesting routine, enabling fast experimentation with
parameters such as trade_buffer and different commission models.
Assumptions and considerations:
Won't allow a position that would be rejected by the broker given user-
supplied margin requirements. Positions that would be rejected are
automatically scaled back.
Similarly, force liquidates the portfolio to conform with margin
requirements (ie simulates a margin call). Contracts are liquidated in equal
proportion - which may not be how a broker actually performs this operation.
Trades only integer number of contracts.
User-specified leverage should be embedded in the target weights values.
Currently only fixed commission models are implemented.
Actual positions are determined using a trade buffer approach: when an
actual portfolio weight differs from its target weight by trade_buffer or
more, rebalance back to the target weight plus or minus the trade_buffer
depending on which side of the target weight the current weight lies.
Uses a user-supplied constant margin requirement for all assets in the
portfolio (TODO: support asset-wise margin requirements)
It is up to the user to align weights and prices prior to passing to this
function. Weights should be date-aligned with the prices at which you assume
you trade into them. This means that you will generally need to lag your
weights upstream.
Works on contract value (close * point value) and assumes all contracts are
in USD (TODO: support contracts denominated in different currencies)

"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rsims</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Wrangling-data-for-input-to-simulation-engine.html">Wrangling data for input to simulation engine</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Futures Backtest, roll on days to expiry, fixed commission model</h1>
    
    <div class="hidden name"><code>fixed_commission_futs_backtest.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Quasi event-based simulation based on desired futures positions, raw
contract prices (ie not backadjusted) and roll dates determine by maximum
open interest.</p>
<p>The function is quite opinionated with respect to the data that it expects.
The idea is that user effort is spent in upstream data wrangling (the
<code>wrangle_contracts_on_oi</code>, <code>make_sim_prices_matrix</code>, and
<code>make_sim_weights_matrix</code> functions help with this), and the payoff is an
extremely efficient backtesting routine, enabling fast experimentation with
parameters such as <code>trade_buffer</code> and different commission models.</p>
<p><strong>Assumptions and considerations</strong>:</p><ul><li><p>Won't allow a position that would be rejected by the broker given user-
supplied margin requirements. Positions that would be rejected are
automatically scaled back.</p></li>
<li><p>Similarly, force liquidates the portfolio to conform with margin
requirements (ie simulates a margin call). Contracts are liquidated in equal
proportion - which may not be how a broker actually performs this operation.</p></li>
<li><p>Trades only integer number of contracts.</p></li>
<li><p>User-specified leverage should be embedded in the target weights values.</p></li>
<li><p>Currently only fixed commission models are implemented.</p></li>
<li><p>Actual positions are determined using a trade buffer approach: when an
actual portfolio weight differs from its target weight by <code>trade_buffer</code> or
more, rebalance back to the target weight plus or minus the <code>trade_buffer</code>
depending on which side of the target weight the current weight lies.</p></li>
<li><p>Uses a user-supplied constant margin requirement for all assets in the
portfolio (TODO: support asset-wise margin requirements)</p></li>
<li><p>It is up to the user to align weights and prices prior to passing to this
function. Weights should be date-aligned with the prices at which you assume
you trade into them. This means that you will generally need to lag your
weights upstream.</p></li>
<li><p>Works on contract value (close * point value) and assumes all contracts are
in USD (TODO: support contracts denominated in different currencies)</p></li>
</ul></div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fixed_commission_futs_backtest</span><span class="op">(</span></span>
<span>  <span class="va">prices</span>,</span>
<span>  <span class="va">target_weights</span>,</span>
<span>  <span class="va">interest_rates</span>,</span>
<span>  trade_buffer <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  initial_cash <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  margin <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  capitalise_profits <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">commission_fun</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>prices</dt>
<dd><p>Matrix of trade prices as per output of
<code>make_sim_prices_matrix</code>. Column 1 must be the
timestamp or index in numerical format.</p></dd>


<dt>target_weights</dt>
<dd><p>Matrix of target weights as per output of
<code>make_sim_weights_matrix</code>. Column 1 must be the timestamp or index in
numerical format.</p></dd>


<dt>interest_rates</dt>
<dd><p>Matrix of daily interest rate applied to cash balance.
Ensure that the rate is adjusted to reflect daily interest. For instance,
many sources quote the rate in %pa - this would require dividing by (365*100).</p></dd>


<dt>trade_buffer</dt>
<dd><p>Trade buffer parameter to prevent hyperactive trading
back to the target weights. When an actual portfolio weight differs from its
target weight by <code>trade_buffer</code> or more, rebalance back to the target weight
plus or minus the <code>trade_buffer</code> depending on which side of the target weight
the current weight lies. This is theoretically optimal if costs are linear.</p></dd>


<dt>initial_cash</dt>
<dd><p>Inital cash balance.</p></dd>


<dt>margin</dt>
<dd><p>Margin requirement as proportion of position value. Currently
a constant value for all assets.</p></dd>


<dt>capitalise_profits</dt>
<dd><p>If TRUE, utilise profits and initial cash balance
in determining position sizes. If FALSE, profits accrue as a cash balance and
are not reinvested.</p></dd>


<dt>commission_fun</dt>
<dd><p>Function for determining commissions from prices and
trades</p></dd>


<dt>...</dt>
<dd><p>Additional arguments passed to commission_fun. For
<code>futs_per_contract_commission</code>, this will be <code>per_contract_commission</code> (a
vector of commissions per contract).</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>long dataframe of results consisting of the following columns:
symbol: Futures symbol without contract designation (eg ES, GC, ZB, etc)
date: In YYYY-MM-DD format
close: Closing contract USD value determined from closing_price*point_value.
contracts: Number of contracts held.
exposure: Value of exposure to current symbol or to Cash.
margin: Dollar value of margin required to maintain exposure.
interest: Interest accrued on yesterday's cash balance and settled today.
settled_cash: Cash settled due to holding positions from yesterday's close
through today's close.
contract_trades: Number of contracts traded, including any positions that
were liquidated fully or partially.
trade_value: Value of contracts traded, including any positions that
were liquidated fully or partially.
rolled_contracts: Number of contracts that were rolled out of today.
roll_price: Price at which rolled contracts were covered (NA if no contracts
were rolled).
commission: Commissions paid on today's trading, including any liquidated
and/or rolled contracts.
margin_call: Boolean indicating whether a margin call occurred today.
reduced_target_pos: Boolean indicating whether target positions could not be
executed due to insufficient margin, and were scaled back accordingly.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Kris Longmore-Dodd.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer></div>

  


  

  </body></html>

